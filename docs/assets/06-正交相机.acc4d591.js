var W=Object.defineProperty;var j=(e,t,o)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var s=(e,t,o)=>(j(e,typeof t!="symbol"?t+"":t,o),o);import"./modulepreload-polyfill.b7f2da20.js";import{i as U}from"./utils.98e3bd0f.js";import{V as u,O as k,M as v,S as V,b as E}from"./vendor.36f02d62.js";var H=`attribute vec4 a_Position;

uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ModelMatrix;


void main() {
  gl_Position = u_ProjectionMatrix*u_ModelMatrix*a_Position; 
}`,Y=`precision mediump float;

uniform vec4 u_Color;

void main() {
  gl_FragColor = u_Color;
}`;const D=()=>({paintType:"POINTS",source:[],attributes:{},uniforms:{},maps:{}});class N{constructor(t){s(this,"gl");s(this,"program");s(this,"paintType");s(this,"source");s(this,"attributes");s(this,"uniforms");s(this,"maps");s(this,"categorySize");s(this,"sourceSize");s(this,"categoryBytes");Object.assign(this,D(),t),this.init()}get elementBytes(){return this.source.BYTES_PER_ELEMENT}init(){this.calculateSize(),this.updateAttribute(),this.updateUniform()}calculateSize(){const{attributes:t,elementBytes:o,source:c}=this;let r=0;Object.values(t).forEach(a=>{r+=a.size,a.byteIndex=a.index*o}),this.categorySize=r,this.categoryBytes=r*o,this.sourceSize=c.length/r}updateAttribute(){const{gl:t,attributes:o,categoryBytes:c,source:r,program:a}=this,d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW);for(const g in o){let{size:p,byteIndex:h}=o[g];const P=t.getAttribLocation(a,g);t.vertexAttribPointer(P,p,t.FLOAT,!1,c,h),t.enableVertexAttribArray(P)}}updateUniform(){const{gl:t,uniforms:o,program:c}=this;for(let r in o){const{type:a,value:d,transpose:g}=o[r],p=t.getUniformLocation(c,r);a.includes("Matrix")?t[a](p,!!g,d):t[a](p,d)}}draw(t=this.paintType){const{gl:o,sourceSize:c}=this;o.drawArrays(o[t],0,c)}}const i=document.querySelector("#canvas");i.width=window.innerWidth;i.height=window.innerHeight;const y=i.getContext("webgl");let q=U(y,H,Y);y.clearColor(0,0,0,1);const _=2,G=i.width/i.height,B=_*G,[X,J,K,Q,Z,$]=[-B,B,_,-_,1,8],tt=new u(1,1,2),m=new u(0,0,-3);new u(0,1,0);const n=new k(X,J,K,Q,Z,$);n.position.copy(tt);n.lookAt(m);n.updateMatrixWorld();const S=new v().multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse);console.log(S.elements);const F=Math.PI*2,w=new V().setFromVector3(n.position.clone().sub(m)),z=b([1,0,0,1],[1,0,0,0,0,1,0,0,0,0,1,0,-.5,0,-3,1]),L=b([1,0,0,1],new v().setPosition(.5,0,-3).elements),T=b([1,1,0,1],new v().setPosition(-.5,0,-2).elements),C=b([1,1,0,1],new v().setPosition(.5,0,-2).elements),et=new Map([[2,"pan"],[0,"rotate"]]);let M="none";const[f,l]=[new E,new E],x=new u;i.addEventListener("contextmenu",e=>{e.preventDefault()});i.addEventListener("pointerdown",({clientX:e,clientY:t,button:o})=>{console.log(e,t,o),f.set(e,t),M=et.get(o)});i.addEventListener("pointermove",e=>{switch(l.set(e.clientX,e.clientY),M){case"pan":nt(e);break;case"rotate":console.log(l.clone().sub(f)),ot(l.clone().sub(f));break}f.copy(l)});i.addEventListener("pointerup",()=>{M="none"});i.addEventListener("pointerleave",()=>{M="none"});const R=.95;i.addEventListener("wheel",({deltaY:e})=>{console.log("deltaY",e),e<0?O(1/R):O(R),A()});function ot({x:e,y:t}){const{clientHeight:o}=i;w.theta-=F*e/o,w.phi-=F*t/o,A()}function O(e){n.zoom*=e,n.updateProjectionMatrix()}function nt({clientX:e,clientY:t}){l.set(e,t),it(l.clone().sub(f)),f.copy(l)}function it(e){const t=n.right-n.left,o=n.top-n.bottom,c=e.x/i.clientWidth,r=e.y/i.clientHeight,a=c*t,d=r*o,p=new u().setFromMatrixColumn(n.matrix,0).clone().multiplyScalar(-a),h=new u;h.setFromMatrixColumn(n.matrix,1),h.multiplyScalar(d),x.copy(p.add(h)),A()}function A(){m.add(x),n.position.add(x);const e=new u().setFromSpherical(w);n.position.copy(m.clone().add(e)),n.lookAt(m),n.updateMatrixWorld(!0),S.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),w.setFromVector3(n.position.clone().sub(m)),x.set(0,0,0),I()}I();function I(){y.clear(y.COLOR_BUFFER_BIT),z.init(),z.draw(),L.init(),L.draw(),T.init(),T.draw(),C.init(),C.draw()}function b(e,t){return new N({gl:y,program:q,source:new Float32Array([0,.3,0,-.3,-.3,0,.3,-.3,0]),paintType:"TRIANGLES",attributes:{a_Position:{size:3,index:0}},uniforms:{u_Color:{type:"uniform4fv",value:e},u_ProjectionMatrix:{type:"uniformMatrix4fv",value:S.elements},u_ModelMatrix:{type:"uniformMatrix4fv",value:t}}})}
