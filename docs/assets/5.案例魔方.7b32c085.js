var R=Object.defineProperty;var A=(r,e,t)=>e in r?R(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var c=(r,e,t)=>(A(r,typeof e!="symbol"?e+"":e,t),t);import"./modulepreload-polyfill.b7f2da20.js";import{i as X,M as u}from"./vendor.e4f064a4.js";var U=`attribute vec4 a_Position;

attribute vec2 a_Pin;
varying vec2 v_Pin;
uniform mat4 u_ModelMatrix;

void main() {

  gl_Position = u_ModelMatrix * a_Position;
  v_Pin = a_Pin;

}`,M=`precision mediump float;
uniform sampler2D u_Sampler;
varying vec2 v_Pin;
void main() {
  gl_FragColor = texture2D(u_Sampler, v_Pin);
}`;function w(r,e,t){const n=r.createProgram(),a=S(r,r.VERTEX_SHADER,e),s=S(r,r.FRAGMENT_SHADER,t);if(r.attachShader(n,a),r.attachShader(n,s),r.linkProgram(n),r.useProgram(n),r.getProgramParameter(n,r.LINK_STATUS)===!1){const i=r.getProgramInfoLog(n).trim(),o=_(r,a,"vertex"),m=_(r,s,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(n,r.VALIDATE_STATUS)+`

Program Info Log: `+i+`
`+o+`
`+m)}return n}function _(r,e,t){const n=r.getShaderParameter(e,r.COMPILE_STATUS),a=r.getShaderInfoLog(e).trim();if(n&&a==="")return"";const s=/ERROR: 0:(\d+)/.exec(a);if(s){const i=parseInt(s[1]);return t.toUpperCase()+`

`+a+`

`+b(r.getShaderSource(e),i)}else return a}function b(r,e){const t=r.split(`
`),n=[],a=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let i=a;i<s;i++){const o=i+1;n.push(`${o===e?">":" "} ${o}: ${t[i]}`)}return n.join(`
`)}function S(r,e,t){const n=r.createShader(e);return n&&(r.shaderSource(n,t),r.compileShader(n)),n}const v=()=>({gl:null,program:null,type:"POINTS",source:new Float32Array,sourceSize:0,elementBytes:0,categorySize:0,categoryBytes:0,attributes:{},uniforms:{},maps:{}});class F{constructor(e){c(this,"gl");c(this,"type");c(this,"source");c(this,"attribute");c(this,"uniforms");c(this,"sourceSize");c(this,"elementBytes");c(this,"categorySize");c(this,"categoryBytes");c(this,"program");c(this,"maps");Object.assign(this,v(),e),this.init()}init(){this.calculateSourceSize(),this.initAttribute(),this.initUniforms()}calculateSourceSize(){this.elementBytes=this.source.BYTES_PER_ELEMENT;let{attribute:e,source:t}=this,n=0;Object.entries(e).forEach(([a,s])=>{n+=s.size}),this.categorySize=n,this.categoryBytes=n*this.elementBytes,this.sourceSize=t.length/n}initAttribute(){let{attribute:e,gl:t,program:n,source:a,categorySize:s,categoryBytes:i,elementBytes:o}=this;const m=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,m),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),Object.entries(e).forEach(([g,l])=>{console.log(l.size,i,l.index*o);let p=t.getAttribLocation(n,g);t.vertexAttribPointer(p,l.size,t.FLOAT,!1,i,l.index*o),t.enableVertexAttribArray(p)})}initUniforms(){let{gl:e,program:t,uniforms:n}=this;Object.entries(n).forEach(([a,s])=>{let i=e.getUniformLocation(t,a);const{type:o,value:m}=s;console.log(o.includes("Matrix")),o.includes("Matrix")?e[o](i,!1,m):e[o](i,m)})}initMaps(){let{gl:e,program:t,maps:n}=this;console.log(n),Object.entries(n).forEach(([a,s],i)=>{const{format:o="RGB",image:m,wrapS:g,wrapT:l,magFilter:p,minFilter:h}=s;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.activeTexture(e[`TEXTURE${i}`]);const P=e.createTexture();e.bindTexture(e.TEXTURE_2D,P),e.texImage2D(e.TEXTURE_2D,0,e[o],e[o],e.UNSIGNED_BYTE,m),g&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e[g]),l&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e[l]),p&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[p]),(!h||e[h]>e.LINEAR)&&e.generateMipmap(e.TEXTURE_2D),h&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[h]);const y=e.getUniformLocation(t,a);e.uniform1i(y,i)})}render(e=this.type){const{gl:t,sourceSize:n}=this;e&&t.drawArrays(t[e],0,n)}}function I(r){let e=new X.GUI,t={originX:0,originY:0,rotateX:0,rotateY:0,rotateZ:0,scaleX:1,scaleY:1,positionX:0,positionY:0,positionZ:0},n=e.addFolder("\u57FA\u70B9");n.open(),n.add(t,"originX").min(-1).max(1).step(.01).onChange(o),n.add(t,"originY").min(-1).max(1).step(.01).onChange(o);let a=e.addFolder("\u65CB\u8F6C");a.open(),a.add(t,"rotateZ").min(0).max(Math.PI*2).step(.01).onChange(o),a.add(t,"rotateY").min(0).max(Math.PI*2).step(.01).onChange(o),a.add(t,"rotateX").min(0).max(Math.PI*2).step(.01).onChange(o);let s=e.addFolder("\u7F29\u653E");s.open(),s.add(t,"scaleX").min(0).max(2).step(.01).onChange(o).name("scale");let i=e.addFolder("\u5E73\u79FB");i.open(),i.add(t,"positionX").min(-1).max(1).step(.01).onChange(o),i.add(t,"positionY").min(-1).max(1).step(.01).onChange(o),i.add(t,"positionZ").min(-1).max(1).step(.01).onChange(o);function o(){r(m())}function m(){return new u().multiply(new u().setPosition(t.originX,t.originY,0).multiply(g(t.rotateX,t.rotateY,t.rotateZ).multiply(new u().setPosition(t.positionX,t.positionY,t.positionZ)).multiply(new u().makeScale(t.scaleX,t.scaleX,t.scaleX))).multiply(new u().setPosition(-t.originX,-t.originY,0)))}m();function g(l,p,h){return new u().makeRotationX(t.rotateX).multiply(new u().makeRotationY(t.rotateY)).multiply(new u().makeRotationZ(t.rotateZ))}}const T=document.querySelector("#canvas");T.width=window.innerWidth;T.height=window.innerHeight;const d=T.getContext("webgl"),B=w(d,U,M);d.enable(d.DEPTH_TEST);d.enable(d.CULL_FACE);const L=new Float32Array([-.5,-.5,-.5,0,0,-.5,.5,-.5,0,.5,.5,-.5,-.5,.25,0,-.5,.5,-.5,0,.5,.5,.5,-.5,.25,.5,.5,-.5,-.5,.25,0,-.5,-.5,.5,.25,0,.5,-.5,.5,.5,0,-.5,.5,.5,.25,.5,-.5,.5,.5,.25,.5,.5,-.5,.5,.5,0,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,0,-.5,.5,.5,.5,.5,.5,.5,-.5,.75,0,-.5,.5,.5,.5,.5,.5,.5,.5,.75,.5,.5,.5,-.5,.75,0,-.5,-.5,-.5,0,.5,.5,-.5,-.5,.25,.5,-.5,-.5,.5,0,1,-.5,-.5,.5,0,1,.5,-.5,-.5,.25,.5,.5,-.5,.5,.25,1,-.5,-.5,-.5,.25,.5,-.5,-.5,.5,.25,1,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.25,1,-.5,.5,.5,.5,1,-.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,.75,.5,.5,-.5,.5,.5,1,.5,-.5,.5,.5,1,.5,.5,-.5,.75,.5,.5,.5,.5,.75,1]);let E=new F({gl:d,program:B,source:L,type:"TRIANGLES",attribute:{a_Position:{size:3,index:0},a_Pin:{size:2,index:3}},uniforms:{u_ModelMatrix:{type:"uniformMatrix4fv",value:new u().elements}}}),f=new Image;f.src="./img/mf.jpg";f.onload=()=>{E.maps={u_Sampler:{image:f}},E.initMaps(),x()};I(r=>{E.uniforms.u_ModelMatrix.value=r.elements,E.initUniforms(),x()});function x(){d.clearColor(0,0,0,1),d.clear(d.COLOR_BUFFER_BIT),E.render()}
